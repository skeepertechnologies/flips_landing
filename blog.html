<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>FLIPS Blog - Environmental Insights</title>
  <meta name="description" content="Explore FLIPS' insights on flood prediction, water management, and environmental monitoring.">
  <meta name="keywords" content="flood prediction, environmental data, water management, FLIPS blog, AI modeling">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <!-- Swiper CSS -->
  <link href="https://unpkg.com/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- Custom CSS for Blog -->
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f8f9fa;
    }
    .blog-section {
      padding: 80px 0;
      background: #fff;
    }
    .blog-post {
      margin-bottom: 20px;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .blog-post img {
      width: 100%;
      height: 400px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
    }
    .blog-post h2 {
      font-size: 2rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      display: inline-block;
    }
    .blog-post .discussion-badge {
      font-size: 0.9rem;
      margin-left: 10px;
      vertical-align: middle;
    }
    .blog-post .meta {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 20px;
    }
    .blog-post .content {
      font-size: 1rem;
      color: #444;
      line-height: 1.8;
      margin-bottom: 30px;
    }
    .comments-section {
      margin-top: 40px;
      padding-top: 20px;
    }
    .comments-section h3 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 20px;
    }
    .comments-container {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 10px;
      margin-bottom: 20px;
    }
    .comment {
      margin-bottom: 15px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .comment.reply {
      margin-left: 20px;
      background: #f1f1f1;
    }
    .comment .comment-author {
      font-weight: 600;
      color: #333;
    }
    .comment .comment-meta {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 10px;
    }
    .comment .comment-content {
      font-size: 0.95rem;
      color: #444;
    }
    .comment .reply-link {
      color: #7b4d11;
      font-size: 0.85rem;
      text-decoration: none;
    }
    .comment .reply-link:hover {
      color: #5a370d;
      text-decoration: underline;
    }
    .comment-form {
      margin-top: 20px;
    }
    .comment-form .btn-primary {
      background: #7b4d11;
      border: none;
    }
    .comment-form .btn-primary:hover {
      background: #5a370d;
    }
    .header {
      background: #fff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .btn-getstarted {
      background: #7b4d11;
      color: #fff;
      border: none;
    }
    .btn-getstarted:hover {
      background: #5a370d;
    }
    /* Swiper Custom Styles */
    .swiper {
      width: 100%;
      padding: 20px 0;
    }
    .swiper-slide {
      display: flex;
      justify-content: center;
    }
    .swiper-button-next,
    .swiper-button-prev {
      color: #7b4d11;
    }
    .swiper-pagination-bullet-active {
      background: #7b4d11;
    }
    @media (max-width: 768px) {
      .blog-post img {
        height: 300px;
      }
      .blog-post h2 {
        font-size: 1.5rem;
      }
      .comment.reply {
        margin-left: 10px;
      }
      .comments-container {
        max-height: 300px;
      }
    }
  </style>
</head>

<body class="blog-page">
  <!-- Header -->
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <img src="assets/img/logo.png" alt="FLIPS Logo" class="img-fluid">
      </a>
      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="index.html#hero" class="nav-link fw-bold">Home</a></li>
          <li><a href="index.html#about" class="nav-link fw-bold">About</a></li>
          <li><a href="about-water.html" class="nav-link fw-bold">About Water</a></li>
          <li><a href="about-ai.html" class="nav-link fw-bold">About AI</a></li>
          <li><a href="index.html#features" class="nav-link fw-bold">Features</a></li>
          <li><a href="index.html#services" class="nav-link fw-bold">Services</a></li>
          <li><a href="index.html#pricing" class="nav-link fw-bold">Pricing</a></li>
          <li><a href="index.html#contact" class="nav-link fw-bold">Contact</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
      <div id="user-status">
        <a class="btn btn-getstarted fw-bold" href="login/login.html">Get Started</a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <!-- Blog Section -->
    <section id="blog" class="blog-section">
      <div class="container" data-aos="fade-up">
        <div class="section-title text-center mb-5">
          <h2>Environmental Insights Blog</h2>
          <p>Read our latest articles on flood prediction, water management, and environmental monitoring.</p>
        </div>
        <!-- Swiper Container -->
        <div class="swiper" id="blog-posts">
          <div class="swiper-wrapper">
            <!-- Blog posts will be populated dynamically as slides -->
          </div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
          <div class="swiper-pagination"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer id="footer" class="footer">
    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="index.html" class="logo d-flex align-items-center">
            <span class="sitename">FLIPS</span>
          </a>
          <div class="footer-contact pt-3">
            <p>Nairobi, Kenya</p>
            <p class="mt-3"><strong>Phone:</strong> <span>+254 700 168 812</span></p>
            <p><strong>Email:</strong> <span>flipsintelligence@gmail.com</span></p>
          </div>
          <div class="social-links d-flex mt-4">
            <a href=""><i class="bi bi-twitter-x"></i></a>
            <a href=""><i class="bi bi-facebook"></i></a>
            <a href="https://www.instagram.com/flips.intel"><i class="bi bi-instagram"></i></a>
            <a href=""><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#about">About us</a></li>
            <li><a href="index.html#services">Services</a></li>
            <li><a href="#">Terms of service</a></li>
            <li><a href="#">Privacy policy</a></li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-3 footer-links">
          <h4>Our Services</h4>
          <ul>
            <li><a href="#">Water management</a></li>
            <li><a href="#">Flood prediction</a></li>
            <li><a href="#">River water level reading</a></li>
            <li><a href="#">ML prediction</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="container copyright text-center mt-4">
      <p>© <span>Copyright</span> <strong class="px-1 sitename">FLIPS</strong> <span>All Rights Reserved</span></p>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center" style="background: #7b4d11; bottom: 90px; right: 30px;"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <!-- Swiper JS -->
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

  <!-- Custom JS for Blog and Comments -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // AOS Initialization
      AOS.init({
        duration: 1000,
        once: true,
      });

      // User Status Handling
      const userStatus = document.getElementById('user-status');
      const loggedInUser = sessionStorage.getItem('loggedInUser');
      const token = sessionStorage.getItem('token');

      if (loggedInUser) {
        const user = JSON.parse(loggedInUser);
        userStatus.innerHTML = `
          <div class="dropdown">
            <button class="btn btn-getstarted fw-bold dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              Welcome, ${user.username}
            </button>
            <ul class="dropdown-menu" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="dashboard.html">Dashboard</a></li>
              <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
            </ul>
          </div>
        `;
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
          e.preventDefault();
          sessionStorage.removeItem('loggedInUser');
          sessionStorage.removeItem('token');
          window.location.href = 'index.html';
        });
      } else {
        userStatus.innerHTML = '<a class="btn btn-getstarted fw-bold" href="login/login.html">Get Started</a>';
      }

      // List of images in assets/img/blog/ (simulating 20+ images)
      const blogImages = Array.from({ length: 21 }, (_, i) => `assets/img/blog/DSC_${i + 1}.JPG`);

      // Function to get a random image
      function getRandomImage() {
        return blogImages[Math.floor(Math.random() * blogImages.length)];
      }

      // Function to classify discussion level based on comment count
      function getDiscussionLevel(commentCount) {
        if (commentCount >= 10) {
          return { label: 'Hot', class: 'badge bg-danger' };
        } else if (commentCount >= 5) {
          return { label: 'Active', class: 'badge bg-success' };
        } else {
          return { label: 'Quiet', class: 'badge bg-secondary' };
        }
      }

      // Static Blog Data (for fallback if API fails)
      const fallbackBlogs = [
        {
          id: 1,
          title: 'The Future of Flood Prediction',
          author: { username: 'FLIPS Team' },
          created_at: '2025-05-20T10:00:00Z',
          content: 'Artificial Intelligence is transforming how we predict and prepare for floods. At FLIPS, our AI models achieve 95% accuracy by analyzing thousands of data points, including rainfall, river levels, and historical flood patterns. This technology empowers businesses to plan disaster responses and individuals to protect their homes.<br><br>Our latest advancements include integrating satellite imagery and real-time sensor data, allowing for hyper-localized predictions. For example, communities in flood-prone areas can receive alerts hours in advance, giving them critical time to evacuate or secure property.'
        },
        {
          id: 2,
          title: 'Real-Time Water Monitoring Benefits',
          author: { username: 'FLIPS Team' },
          created_at: '2025-05-15T10:00:00Z',
          content: 'Real-time water level monitoring is a cornerstone of effective flood prevention. FLIPS’ sensors and dashboards provide instant updates on river and stream levels, enabling communities to act swiftly when risks arise.<br><br>For businesses, this data supports resource allocation and risk assessment. For individuals, it means peace of mind knowing they can monitor local water bodies from their phones. Our case studies show a 30% reduction in flood-related damages for users leveraging real-time data.'
        },
        {
          id: 3,
          title: 'Disaster Preparedness Strategies',
          author: { username: 'FLIPS Team' },
          created_at: '2025-05-10T10:00:00Z',
          content: 'Effective disaster preparedness can mitigate the impact of floods on businesses and communities. FLIPS provides detailed flood risk reports and API access, enabling organizations to integrate predictive data into their planning processes.<br><br>From insurance firms optimizing claims to NGOs coordinating relief efforts, our tools help stakeholders act proactively. Individuals also benefit from SMS alerts and dashboards tailored for home safety.'
        }
      ];

      // Initialize Swiper
      function initializeSwiper() {
        new Swiper('#blog-posts', {
          slidesPerView: 1,
          spaceBetween: 20,
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          breakpoints: {
            768: {
              slidesPerView: 2,
            },
            1200: {
              slidesPerView: 3,
            },
          },
        });
      }

      // Fetch Blog Posts
      async function fetchBlogPosts() {
        try {
          const response = await fetch('http://your-django-api-url/api/blogs/', {
            headers: {
              'Authorization': `Bearer ${token || ''}`
            }
          });
          let blogs = await response.json();
          blogs = blogs.results || blogs; // Handle pagination if API returns results
          const blogContainer = document.querySelector('#blog-posts .swiper-wrapper');
          blogContainer.innerHTML = blogs.map((blog, index) => {
            const comments = JSON.parse(localStorage.getItem(`comments_${blog.id}`) || '[]');
            const discussion = getDiscussionLevel(comments.length);
            return `
              <div class="swiper-slide">
                <div id="post-${blog.id}" class="blog-post" data-aos="fade-up" data-aos-delay="${100 + index * 100}">
                  <h2>${blog.title} <span class="${discussion.class} discussion-badge">${discussion.label}</span></h2>
                  <div class="meta">Posted by ${blog.author.username} on ${new Date(blog.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                  <img src="${getRandomImage()}" alt="${blog.title}">
                  <div class="content">${blog.content}</div>
                  <div class="comments-section" id="comments-${blog.id}">
                    <h3>Comments</h3>
                    <div class="card">
                      <div class="card-body comments-container" id="comment-list-${blog.id}">
                        <!-- Comments will be populated from localStorage -->
                      </div>
                    </div>
                    ${loggedInUser ? `
                      <form class="comment-form" data-blog-id="${blog.id}" onsubmit="submitComment(event, ${blog.id})">
                        <textarea class="form-control mb-3" rows="5" placeholder="Add a Comment" required></textarea>
                        <button type="submit" class="btn btn-primary">Post Comment</button>
                      </form>
                    ` : '<p>Please <a href="login/login.html">log in</a> to post a comment.</p>'}
                  </div>
                </div>
              </div>
            `;
          }).join('');

          // Fetch comments for each blog
          blogs.forEach(blog => fetchComments(blog.id));

          // Initialize Swiper after content is loaded
          initializeSwiper();
        } catch (error) {
          console.error('Error fetching blog posts:', error);
          // Use fallback data
          const blogContainer = document.querySelector('#blog-posts .swiper-wrapper');
          blogContainer.innerHTML = fallbackBlogs.map((blog, index) => {
            const comments = JSON.parse(localStorage.getItem(`comments_${blog.id}`) || '[]');
            const discussion = getDiscussionLevel(comments.length);
            return `
              <div class="swiper-slide">
                <div id="post-${blog.id}" class="blog-post" data-aos="fade-up" data-aos-delay="${100 + index * 100}">
                  <h2>${blog.title} <span class="${discussion.class} discussion-badge">${discussion.label}</span></h2>
                  <div class="meta">Posted by ${blog.author.username} on ${new Date(blog.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                  <img src="${getRandomImage()}" alt="${blog.title}">
                  <div class="content">${blog.content}</div>
                  <div class="comments-section" id="comments-${blog.id}">
                    <h3>Comments</h3>
                    <div class="card">
                      <div class="card-body comments-container" id="comment-list-${blog.id}">
                        <!-- Comments will be populated from localStorage -->
                      </div>
                    </div>
                    ${loggedInUser ? `
                      <form class="comment-form" data-blog-id="${blog.id}" onsubmit="submitComment(event, ${blog.id})">
                        <textarea class="form-control mb-3" rows="5" placeholder="Add a Comment" required></textarea>
                        <button type="submit" class="btn btn-primary">Post Comment</button>
                      </form>
                    ` : '<p>Please <a href="login/login.html">log in</a> to post a comment.</p>'}
                  </div>
                </div>
              </div>
            `;
          }).join('');
          fallbackBlogs.forEach(blog => fetchComments(blog.id));

          // Initialize Swiper after content is loaded
          initializeSwiper();
        }
      }

      // Fetch Comments from localStorage
      function fetchComments(blogId) {
        const comments = JSON.parse(localStorage.getItem(`comments_${blogId}`) || '[]');
        const commentList = document.getElementById(`comment-list-${blogId}`);
        commentList.innerHTML = comments.filter(c => !c.parentId).map(comment => renderComment(comment, blogId, comments)).join('');
        // Update discussion badge after fetching comments
        updateDiscussionBadge(blogId, comments.length);
      }

      // Update Discussion Badge
      function updateDiscussionBadge(blogId, commentCount) {
        const blogPost = document.getElementById(`post-${blogId}`);
        if (blogPost) {
          const badge = blogPost.querySelector('.discussion-badge');
          if (badge) {
            const discussion = getDiscussionLevel(commentCount);
            badge.textContent = discussion.label;
            badge.className = `badge ${discussion.class} discussion-badge`;
          }
        }
      }

      // Render a Comment (with Nested Replies)
      function renderComment(comment, blogId, allComments) {
        const replies = allComments
          .filter(reply => reply.parentId === comment.id)
          .map(reply => `
            <div class="comment reply" id="comment-${reply.id}">
              <div class="comment-author">${reply.user.username}</div>
              <div class="comment-meta">${new Date(reply.created_at).toLocaleString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true })}</div>
              <div class="comment-content">${reply.content}</div>
              <a href="#" class="reply-link" onclick="showReplyForm('reply-form-${reply.id}')">Reply</a>
              <form id="reply-form-${reply.id}" class="comment-form reply-form d-none" onsubmit="submitComment(event, ${blogId}, ${reply.id})">
                <textarea class="form-control mb-3" rows="3" placeholder="Your Reply" required></textarea>
                <button type="submit" class="btn btn-primary">Post Reply</button>
              </form>
            </div>
          `).join('');

        return `
          <div class="comment" id="comment-${comment.id}">
            <div class="comment-author">${comment.user.username}</div>
            <div class="comment-meta">${new Date(comment.created_at).toLocaleString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true })}</div>
            <div class="comment-content">${comment.content}</div>
            <a href="#" class="reply-link" onclick="showReplyForm('reply-form-${comment.id}')">Reply</a>
            <form id="reply-form-${comment.id}" class="comment-form reply-form d-none" onsubmit="submitComment(event, ${blogId}, ${comment.id})">
              <textarea class="form-control mb-3" rows="3" placeholder="Your Reply" required></textarea>
              <button type="submit" class="btn btn-primary">Post Reply</button>
            </form>
            ${replies}
          </div>
        `;
      }

      // Show Reply Form
      function showReplyForm(formId) {
        const form = document.getElementById(formId);
        form.classList.toggle('d-none');
      }

      // Submit Comment
      function submitComment(event, blogId, parentId = null) {
        event.preventDefault();
        const loggedInUser = sessionStorage.getItem('loggedInUser');
        if (!loggedInUser) {
          alert('Please log in to post a comment.');
          window.location.href = 'login/login.html';
          return;
        }

        const form = event.target;
        const content = form.querySelector('textarea').value;
        const user = JSON.parse(loggedInUser);
        const comments = JSON.parse(localStorage.getItem(`comments_${blogId}`) || '[]');
        const newComment = {
          id: Date.now(), // Unique ID based on timestamp
          blogId: blogId,
          user: { username: user.username },
          content: content,
          parentId: parentId,
          created_at: new Date().toISOString()
        };

        comments.push(newComment);
        localStorage.setItem(`comments_${blogId}`, JSON.stringify(comments));

        form.reset();
        if (parentId) form.classList.add('d-none');
        fetchComments(blogId); // Refresh comments
      }

      // Initialize with some sample comments in localStorage (for testing)
      function initializeSampleComments() {
        const sampleComments = {
          comments_1: [
            ...Array(10).fill().map((_, i) => ({
              id: i + 1,
              blogId: 1,
              user: { username: `User${i + 1}` },
              content: `Comment ${i + 1} on flood prediction!`,
              parentId: i === 1 ? 1 : null,
              created_at: `2025-05-21T${10 + i}:30:00Z`
            }))
          ],
          comments_2: [
            ...Array(6).fill().map((_, i) => ({
              id: i + 11,
              blogId: 2,
              user: { username: `User${i + 11}` },
              content: `Comment ${i + 1} on water monitoring!`,
              parentId: i === 1 ? 11 : null,
              created_at: `2025-05-16T${9 + i}:45:00Z`
            }))
          ],
          comments_3: [
            {
              id: 17,
              blogId: 3,
              user: { username: 'David Kimani' },
              content: 'Great insights! How customizable are the risk reports for specific regions?',
              parentId: null,
              created_at: '2025-05-11T11:20:00Z'
            },
            {
              id: 18,
              blogId: 3,
              user: { username: 'FLIPS Team' },
              content: 'Thanks, David! Reports are highly customizable by region. Reach out for a demo!',
              parentId: 17,
              created_at: '2025-05-11T16:30:00Z'
            }
          ]
        };

        Object.keys(sampleComments).forEach(key => {
          if (!localStorage.getItem(key)) {
            localStorage.setItem(key, JSON.stringify(sampleComments[key]));
          }
        });
      }

      // Initialize
      initializeSampleComments();
      fetchBlogPosts();
    });
  </script>
</body>
</html>